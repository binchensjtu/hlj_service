/* jquery-nod - v1.0.4 - 2014-06-11 
 * https://github.com/casperin/nod 
 * Gorm Casper: Licensed MIT
 */
!function($){var Checker,__bind=function(a,b){return function(){return a.apply(b,arguments)}};Checker=function(){function a(a,b){this.run=__bind(this.run,this);var c;c=b[0],this.metric=b[1],this.getVal=this.makeGetVal(a,c)}return a.prototype.run=function(){return this.verify(this.metric,this.getVal())},a.prototype.makeGetVal=function(a,b){var c,d,e;return e=a.attr("type"),"checkbox"===e?function(){return a.is(":checked")}:"radio"===e?(d=a.attr("name"),function(){return $('[name="'+d+'"]').filter(":checked").val()}):"one-of"===this.metric?(c=$(b),function(){return c.map(function(){return $.trim(this.value)}).get().join("")}):function(){return $.trim(a.val())}},a.prototype.verify=function(a,b){var c,d,e,f;if(a&&a.constructor&&a.call&&a.apply)return a(b);if(a instanceof RegExp)return a.test(b);if(f=$.map(a.split(":"),$.trim),e=f[0],c=f[1],d=f[2],"same-as"===e&&1!==$(c).length)throw new Error("same-as selector must target one and only one element");if(!b&&"presence"!==e&&"one-of"!==e)return!0;switch(e){case"presence":return!!b;case"one-of":return!!b;case"exact":return b===c;case"not":return b!==c;case"same-as":return b===$(c).val();case"min-num":return+b>=+c;case"max-num":return+c>=+b;case"between-num":return+b>=+c&&+d>=+b;case"min-length":return b.length>=+c;case"max-length":return b.length<=+c;case"exact-length":return b.length===+c;case"between":return b.length>=+c&&b.length<=+d;case"integer":return/^\s*\d+\s*$/.test(b);case"float":return/^[-+]?[0-9]+(\.[0-9]+)?$/.test(b);case"date":return new Date(b)instanceof Date;case"dd MMM yyyy":return/^(\d{2}) ([a-zA-Z]{3}) (\d{4})$/.test(b);case"dd-MMM-yyyy":return/^(\d{2})-([a-zA-Z]{3})-(\d{4})$/.test(b);case"email":return this.email(b);default:throw new Error("I don't know "+e+", sorry.")}},a.prototype.email=function(a){var b;return b=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/,b.test(a)},a}();var Listener,__bind=function(a,b){return function(){return a.apply(b,arguments)}};Listener=function(){function Listener(a,b,c){this.get=b,this.field=c,this.change_status=__bind(this.change_status,this),this.runCheck=__bind(this.runCheck,this),this.delayedCheck=__bind(this.delayedCheck,this),this.events=__bind(this.events,this),this.$el=$(a),this.delayId="",this.status=null,this.checker=new Checker(this.$el,this.field),this.msg=new Msg(this.$el,this.get,this.field),this.events()}return Listener.prototype.events=function(){return"radio"===this.$el.attr("type")?$('[name="'+this.$el.attr("name")+'"]').on("change",this.runCheck):(this.$el.on("change",this.runCheck),this.$el.on("blur",this.runCheck),"one-of"===this.field[1]&&$(window).on("nod-run-one-of",this.runCheck),this.get.delay?this.$el.on("keyup",this.delayedCheck):void 0)},Listener.prototype.delayedCheck=function(){return clearTimeout(this.delayId),this.delayId=setTimeout(this.runCheck,this.get.delay)},Listener.prototype.runCheck=function(){return $.when(this.checker.run()).then(this.change_status)},Listener.prototype.change_status=function(status){var isCorrect;try{status=eval(status)}catch(_error){}return isCorrect=!!status,this.status!==isCorrect?(this.status=isCorrect,this.msg.toggle(this.status),$(this).trigger("nod_toggle"),"one-of"===this.field[1]&&status?$(window).trigger("nod-run-one-of"):void 0):void 0},Listener}();var Msg,__bind=function(a,b){return function(){return a.apply(b,arguments)}};Msg=function(){function a(a,b,c){this.$el=a,this.get=b,this.createShowMsg=__bind(this.createShowMsg,this),this.toggle=__bind(this.toggle,this),this.createMsg=__bind(this.createMsg,this),this.$msg=this.createMsg(c[2]),this.showMsg=this.createShowMsg()}return a.prototype.createMsg=function(a){return $("<span/>",{html:a,"class":this.get.helpSpanDisplay+" "+this.get.errorClass})},a.prototype.toggle=function(a){return a?this.$msg.remove():(this.showMsg(),this.get.broadcastError?this.broadcast():void 0)},a.prototype.createShowMsg=function(){var a,b;return b=this.$el.attr("type"),"checkbox"===b||"radio"===b?function(){return this.$el.parent().append(this.$msg)}:(a=this.findPos(this.$el),function(){return a.after(this.$msg)})},a.prototype.findPos=function(a){return this.elHasClass("parent",a)?this.findPos(a.parent()):this.elHasClass("next",a)?this.findPos(a.next()):a},a.prototype.elHasClass=function(a,b){var c,d,e,f;for(f=this.get.errorPosClasses,d=0,e=f.length;e>d;d++)if(c=f[d],b[a](c).length)return!0;return!1},a.prototype.broadcast=function(){return $(window).trigger("nod_error_fired",{el:this.$el,msg:this.$msg.html()})},a}();var Nod,__bind=function(a,b){return function(){return a.apply(b,arguments)}};Nod=function(){function a(a,b,c){this.form=a,this.formIsErrorFree=__bind(this.formIsErrorFree,this),this.submitForm=__bind(this.submitForm,this),this.toggleSubmitBtnText=__bind(this.toggleSubmitBtnText,this),this.toggleSubmitBtn=__bind(this.toggleSubmitBtn,this),this.toggleGroupClass=__bind(this.toggleGroupClass,this),this.toggle_status=__bind(this.toggle_status,this),this.massCheck=__bind(this.massCheck,this),this.listenForEnter=__bind(this.listenForEnter,this),this.events=__bind(this.events,this),this.createListeners=__bind(this.createListeners,this),b&&(this.form[0].__nod=this,this.get=$.extend({delay:700,disableSubmitBtn:!0,helpSpanDisplay:"help-block",groupClass:"has-error",submitBtnSelector:"[type=submit]",metricsSplitter:":",errorPosClasses:[".help-block",".add-on","button",".input-append"],silentSubmit:!1,broadcastError:!1,errorClass:"nod_msg",groupSelector:".form-group"},c),this.listeners=this.createListeners(b),this.submit=this.form.find(this.get.submitBtnSelector),this.checkIfElementsExist(this.form,this.submit,this.get.disableSubmitBtn),this.events())}return a.prototype.createListeners=function(a){var b,c,d,e,f,g,h,i;for(d=[],e=0,g=a.length;g>e;e++)for(c=a[e],3!==c.length&&this["throw"]("field",c),i=this.form.find(c[0]),f=0,h=i.length;h>f;f++)b=i[f],d.push(new Listener(b,this.get,c));return d},a.prototype.events=function(){var a,b,c,d;for(d=this.listeners,b=0,c=d.length;c>b;b++)a=d[b],$(a).on("nod_toggle",this.toggle_status);return this.submit.length?this.submit.on("click",this.massCheck):this.form.on("keyup",this.listenForEnter)},a.prototype.listenForEnter=function(a){return 13===a.keyCode?this.massCheck():void 0},a.prototype.massCheck=function(a){var b,c,d,e,f;for(null!=a&&a.preventDefault(),b=[],f=this.listeners,d=0,e=f.length;e>d;d++)c=f[d],b.push(c.runCheck());return this.toggleSubmitBtnText(),$.when.apply($,b).then(this.submitForm).then(this.toggleSubmitBtnText)},a.prototype.toggle_status=function(a){return this.toggleGroupClass(a.target.$el.parents(this.get.groupSelector)),this.get.disableSubmitBtn?this.toggleSubmitBtn():void 0},a.prototype.toggleGroupClass=function(a){return a.find("."+this.get.errorClass).length?a.addClass(this.get.groupClass):a.removeClass(this.get.groupClass)},a.prototype.toggleSubmitBtn=function(){return this.formIsErrorFree()?this.submit.removeClass("disabled").removeAttr("disabled"):this.submit.addClass("disabled").attr("disabled","disabled")},a.prototype.toggleSubmitBtnText=function(){var a;return a=this.submit.attr("data-loading-text"),a?(this.submit.attr("data-loading-text",this.submit.html()),this.submit.html(a)):void 0},a.prototype.submitForm=function(){var a;if(this.formIsErrorFree())return this.get.silentSubmit?(a=$(this.form),a.trigger("silentSubmit",a.serialize())):this.form.submit()},a.prototype.formIsErrorFree=function(){return!$(this.listeners).filter(function(){return null===this.status&&this.runCheck(),!this.status}).length},a.prototype.checkIfElementsExist=function(a,b,c){return a.selector&&a.length||this["throw"]("form",a),!b.length&&c?this["throw"]("submit",b):void 0},a.prototype["throw"]=function(a,b){var c;switch(a){case"form":c="Couldn't find form: ";break;case"submit":c="Couldn't find submit button: ";break;case"field":c="Metrics for each field must have three parts: "}throw new Error(c+b)},a}(),$.fn.nod=function(a,b){return a||b?(new Nod(this,a,b),this):this[0].__nod}}(jQuery);